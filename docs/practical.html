<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>6 Practical: Pair coding with GitHub | A Minimal Introduction to Ecological Forecasting and Reproducible Research</title>
  <meta name="description" content="This is a minimal introduction to Ecological Forecasting and Reproducible Research for the 3rd year undergraduate Biological Sciences BIO3019S class at the University of Cape Town." />
  <meta name="generator" content="bookdown 0.22 and GitBook 2.6.7" />

  <meta property="og:title" content="6 Practical: Pair coding with GitHub | A Minimal Introduction to Ecological Forecasting and Reproducible Research" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This is a minimal introduction to Ecological Forecasting and Reproducible Research for the 3rd year undergraduate Biological Sciences BIO3019S class at the University of Cape Town." />
  <meta name="github-repo" content="jslingsby/BIO3019S_Ecoforecasting" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="6 Practical: Pair coding with GitHub | A Minimal Introduction to Ecological Forecasting and Reproducible Research" />
  
  <meta name="twitter:description" content="This is a minimal introduction to Ecological Forecasting and Reproducible Research for the 3rd year undergraduate Biological Sciences BIO3019S class at the University of Cape Town." />
  

<meta name="author" content="Jasper Slingsby" />


<meta name="date" content="2021-10-02" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="reproducibility.html"/>
<link rel="next" href="references.html"/>
<script src="libs/header-attrs-2.11/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">A Minimal Introduction to Ecological Forecasting and Reproducible Research</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Overview</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#general"><i class="fa fa-check"></i><b>1.1</b> General</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#lectures-and-practicals"><i class="fa fa-check"></i><b>1.2</b> Lectures and practicals</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#preparation"><i class="fa fa-check"></i><b>1.3</b> Preparation</a></li>
<li class="chapter" data-level="1.4" data-path="index.html"><a href="index.html#a-bit-about-me"><i class="fa fa-check"></i><b>1.4</b> A bit about me</a></li>
<li class="chapter" data-level="1.5" data-path="index.html"><a href="index.html#acknowledgements-and-further-reading"><i class="fa fa-check"></i><b>1.5</b> Acknowledgements and further reading:</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="pracprep.html"><a href="pracprep.html"><i class="fa fa-check"></i><b>2</b> Preparation for the practical</a></li>
<li class="chapter" data-level="3" data-path="models.html"><a href="models.html"><i class="fa fa-check"></i><b>3</b> Models and decision making</a>
<ul>
<li class="chapter" data-level="3.1" data-path="models.html"><a href="models.html#the-basics-of-making-a-decision"><i class="fa fa-check"></i><b>3.1</b> The basics of making a decision</a></li>
<li class="chapter" data-level="3.2" data-path="models.html"><a href="models.html#getting-quantitative"><i class="fa fa-check"></i><b>3.2</b> Getting quantitative</a></li>
<li class="chapter" data-level="3.3" data-path="models.html"><a href="models.html#iterative-decision-making"><i class="fa fa-check"></i><b>3.3</b> Iterative decision-making</a></li>
<li class="chapter" data-level="3.4" data-path="models.html"><a href="models.html#iterative-decision-making-and-the-scientific-method"><i class="fa fa-check"></i><b>3.4</b> Iterative decision-making and the scientific method</a></li>
<li class="chapter" data-level="3.5" data-path="models.html"><a href="models.html#the-importance-of-prediction-in-ecology"><i class="fa fa-check"></i><b>3.5</b> The importance of prediction in ecology</a></li>
<li class="chapter" data-level="3.6" data-path="models.html"><a href="models.html#iterative-near-term-ecological-forecasting"><i class="fa fa-check"></i><b>3.6</b> Iterative near-term ecological forecasting</a></li>
<li class="chapter" data-level="3.7" data-path="models.html"><a href="models.html#iterative-ecological-forecasting-in-context"><i class="fa fa-check"></i><b>3.7</b> Iterative ecological forecasting in context</a></li>
<li class="chapter" data-level="3.8" data-path="models.html"><a href="models.html#reproducible-research"><i class="fa fa-check"></i><b>3.8</b> Reproducible research</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="forecasts.html"><a href="forecasts.html"><i class="fa fa-check"></i><b>4</b> Making forecasts</a>
<ul>
<li class="chapter" data-level="4.1" data-path="forecasts.html"><a href="forecasts.html#proteaceae-as-a-model-organisms"><i class="fa fa-check"></i><b>4.1</b> Proteaceae as a model organisms</a></li>
<li class="chapter" data-level="4.2" data-path="forecasts.html"><a href="forecasts.html#proteaceae-as-management-indicators"><i class="fa fa-check"></i><b>4.2</b> Proteaceae as management indicators</a></li>
<li class="chapter" data-level="4.3" data-path="forecasts.html"><a href="forecasts.html#potential-issues-with-the-rules-of-thumb"><i class="fa fa-check"></i><b>4.3</b> Potential issues with the rules of thumb…</a></li>
<li class="chapter" data-level="4.4" data-path="forecasts.html"><a href="forecasts.html#assessing-population-viability"><i class="fa fa-check"></i><b>4.4</b> Assessing population viability</a></li>
<li class="chapter" data-level="4.5" data-path="forecasts.html"><a href="forecasts.html#climate-and-fire-driven-changes-in-demographic-rates-and-distribution"><i class="fa fa-check"></i><b>4.5</b> Climate and fire-driven changes in demographic rates and distribution</a></li>
<li class="chapter" data-level="4.6" data-path="forecasts.html"><a href="forecasts.html#near-term-iterative-ecological-forecasts"><i class="fa fa-check"></i><b>4.6</b> Near-term iterative ecological forecasts?</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="reproducibility.html"><a href="reproducibility.html"><i class="fa fa-check"></i><b>5</b> Reproducible research</a>
<ul>
<li class="chapter" data-level="5.1" data-path="reproducibility.html"><a href="reproducibility.html#the-reproducibility-crisis"><i class="fa fa-check"></i><b>5.1</b> The Reproducibility Crisis</a></li>
<li class="chapter" data-level="5.2" data-path="reproducibility.html"><a href="reproducibility.html#replication-and-the-reproducibility-spectrum"><i class="fa fa-check"></i><b>5.2</b> Replication and the Reproducibility Spectrum</a></li>
<li class="chapter" data-level="5.3" data-path="reproducibility.html"><a href="reproducibility.html#why-work-reproducibly"><i class="fa fa-check"></i><b>5.3</b> Why work reproducibly?</a></li>
<li class="chapter" data-level="5.4" data-path="reproducibility.html"><a href="reproducibility.html#barriers-to-working-reproducibly"><i class="fa fa-check"></i><b>5.4</b> Barriers to working reproducibly</a></li>
<li class="chapter" data-level="5.5" data-path="reproducibility.html"><a href="reproducibility.html#reproducible-scientific-workflows"><i class="fa fa-check"></i><b>5.5</b> Reproducible Scientific Workflows</a>
<ul>
<li class="chapter" data-level="5.5.1" data-path="reproducibility.html"><a href="reproducibility.html#file-and-folder-management"><i class="fa fa-check"></i><b>5.5.1</b> File and folder management</a></li>
<li class="chapter" data-level="5.5.2" data-path="reproducibility.html"><a href="reproducibility.html#coding-and-code-management"><i class="fa fa-check"></i><b>5.5.2</b> Coding and code management</a></li>
<li class="chapter" data-level="5.5.3" data-path="reproducibility.html"><a href="reproducibility.html#computing-environment-and-software"><i class="fa fa-check"></i><b>5.5.3</b> Computing environment and software</a></li>
<li class="chapter" data-level="5.5.4" data-path="reproducibility.html"><a href="reproducibility.html#sharing-of-the-data-code-publication-etc"><i class="fa fa-check"></i><b>5.5.4</b> Sharing of the data, code, publication etc</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="practical.html"><a href="practical.html"><i class="fa fa-check"></i><b>6</b> Practical: Pair coding with GitHub</a>
<ul>
<li class="chapter" data-level="6.1" data-path="practical.html"><a href="practical.html#objectives"><i class="fa fa-check"></i><b>6.1</b> Objectives</a></li>
<li class="chapter" data-level="6.2" data-path="practical.html"><a href="practical.html#postfire-regeneration"><i class="fa fa-check"></i><b>6.2</b> Postfire regeneration</a></li>
<li class="chapter" data-level="6.3" data-path="practical.html"><a href="practical.html#modular-design"><i class="fa fa-check"></i><b>6.3</b> Modular Design</a></li>
<li class="chapter" data-level="6.4" data-path="practical.html"><a href="practical.html#task-1-create-clone-repository"><i class="fa fa-check"></i><b>6.4</b> Task 1: Create &amp; Clone Repository</a>
<ul>
<li class="chapter" data-level="6.4.1" data-path="practical.html"><a href="practical.html#owner"><i class="fa fa-check"></i><b>6.4.1</b> OWNER</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="practical.html"><a href="practical.html#task-2-add-the-first-function-download.ndvi"><i class="fa fa-check"></i><b>6.5</b> Task 2: Add the first function: download.NDVI</a>
<ul>
<li class="chapter" data-level="6.5.1" data-path="practical.html"><a href="practical.html#owner-1"><i class="fa fa-check"></i><b>6.5.1</b> OWNER</a></li>
</ul></li>
<li class="chapter" data-level="6.6" data-path="practical.html"><a href="practical.html#task-3-collaborator-adds-plot.ndvi"><i class="fa fa-check"></i><b>6.6</b> Task 3: Collaborator adds plot.NDVI</a>
<ul>
<li class="chapter" data-level="6.6.1" data-path="practical.html"><a href="practical.html#collaborator"><i class="fa fa-check"></i><b>6.6.1</b> COLLABORATOR</a></li>
<li class="chapter" data-level="6.6.2" data-path="practical.html"><a href="practical.html#owner-2"><i class="fa fa-check"></i><b>6.6.2</b> OWNER</a></li>
</ul></li>
<li class="chapter" data-level="6.7" data-path="practical.html"><a href="practical.html#task-4-owner-adds-functions-for-model-fitting-using-mle"><i class="fa fa-check"></i><b>6.7</b> Task 4: Owner adds functions for model fitting using MLE</a>
<ul>
<li class="chapter" data-level="6.7.1" data-path="practical.html"><a href="practical.html#owner-3"><i class="fa fa-check"></i><b>6.7.1</b> OWNER</a></li>
</ul></li>
<li class="chapter" data-level="6.8" data-path="practical.html"><a href="practical.html#task-5-collaborator-adds-the-master-script"><i class="fa fa-check"></i><b>6.8</b> Task 5: Collaborator adds the master script</a>
<ul>
<li class="chapter" data-level="6.8.1" data-path="practical.html"><a href="practical.html#collaborator-1"><i class="fa fa-check"></i><b>6.8.1</b> COLLABORATOR</a></li>
</ul></li>
<li class="chapter" data-level="6.9" data-path="practical.html"><a href="practical.html#master-script-for-postfire-analysis"><i class="fa fa-check"></i><b>6.9</b> Master script for postfire analysis</a>
<ul>
<li class="chapter" data-level="6.9.1" data-path="practical.html"><a href="practical.html#owner-4"><i class="fa fa-check"></i><b>6.9.1</b> OWNER</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/jslingsby/BIO3019S_Ecoforecasting" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">A Minimal Introduction to Ecological Forecasting and Reproducible Research</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="practical" class="section level1" number="6">
<h1><span class="header-section-number">6</span> Practical: Pair coding with GitHub</h1>
<p><br></p>
<blockquote>
<p><em>Just a quick acknowledgement that I have adapted much of the framework for the following from Michael Dietze’s <a href="https://github.com/EcoForecast/EF_Activities/blob/master/Exercise_04_PairCoding.Rmd"><strong>Pair coding practical</strong></a> that is a living online supplement to his book <span class="citation">(<a href="#ref-Dietze2017" role="doc-biblioref">Dietze 2017</a>)</span>. Thanks for sharing the code under an MIT license Mike! The main differences are that I’ve changes the subject matter from looking at phenology in Tall Grass Prairie using PhenoCam data to looking at postfire vegetation growth in Fynbos using MODIS satellite Normalized Difference Vegetation Index (NDVI), a measure of vegetation “greenness.” This includes changing the core model we fit too.</em></p>
</blockquote>
<p><br></p>
<div id="objectives" class="section level2" number="6.1">
<h2><span class="header-section-number">6.1</span> Objectives</h2>
<p>The primary goal of this exercise is to gain experience working collaboratively to develop a scientific workflow. As such, this assignment must be completed with a partner. Specifically, we will outline an analysis, break the overall job into parts, and have each person complete part of the project. To put these parts together we will be using GitHub.</p>
<p>Along the way we will also be exploring the statistical concept of Likelihood by fitting the same model and estimating the parameters with two very different approaches - <em>Least Squares</em> and <em>Maximum Likelihood</em>.</p>
<p><br></p>
</div>
<div id="postfire-regeneration" class="section level2" number="6.2">
<h2><span class="header-section-number">6.2</span> Postfire regeneration</h2>
<p><br>
The goal of our analysis is to investigate the regeneration of Fynbos vegetation after fire by exploring a time-series of 16-day composite Normalized Difference Vegetation Index (NDVI) from the MODIS satellite mission, a measure of vegetation “greenness.” You can read up on the data product <a href="https://modis.gsfc.nasa.gov/data/dataprod/mod13.php">here</a>. We’ll be using data for one location (250m by 250m pixel) from the Silvermine section of Table Mountain National Park. You can view the raw data in comma-separated value (.csv) format <a href="https://github.com/jslingsby/BIO3019S_Ecoforecasting/blob/master/data/modisdata.csv">here</a>.</p>
<p><br></p>
<p>The workflow for this analysis with have three components:</p>
<ol style="list-style-type: decimal">
<li>Download MODIS NDVI data</li>
<li>Visualize the data</li>
<li>Fit two competing negative exponential model using non-linear least squares (NLS)</li>
<li>Fit the same models using Maximum Likelihood Estimation (MLE) and compare them using a likelihood ratio test</li>
</ol>
<p>From this overall design, let’s next outline the specific steps involved as pseudocode</p>
<pre><code>### Fynbos Postfire Workflow
## Download NDVI data for one postfire recovery cycle
## Visualize data
## Fit two variants of the negative exponential model with NLS
## Visualize models and data
## Fit two variants of the negative exponential model with MLE
## Visualize models and data
## Compare model variants using a Likelihood Ratio Test</code></pre>
</div>
<div id="modular-design" class="section level2" number="6.3">
<h2><span class="header-section-number">6.3</span> Modular Design</h2>
<p>From this overall design we can look for ways to modularize the analysis. One feature that jumps out is that we need to visualize the data three times, so we should definitely make a function to do that. The inputs to the function would be an x-axis (<code>age</code>) and a y-axis (<code>NDVI</code>), which we might pass to the function as a dataframe for convenience. Since this is a graphing function we’d also like the ability to set all sorts of plot characteristics, which can be done in R by passing <code>...</code> as an argument and then passing that on to the internal <em>plot</em> call. The proposed function interface would thus be</p>
<pre><code>##&#39; Plot NDVI data
##&#39;
##&#39; @param dat  dataframe that contains columns &quot;age&quot; and &quot;NDVI&quot;
##&#39; @param fit  a fitted model to overlay on the data if present
##&#39; @param ...  additional graphing parameters
##&#39; 
plot.NDVI &lt;- function(dat, fit = NA, ...)</code></pre>
<p>Next, because the raw data will be downloaded off the web and we need to convert the dates from “character” to “Date” class and convert the dates let’s go ahead and create a download function. This function just needs to know the URL for where to find the data. Unlike the plot function, this function will return something (the data that was downloaded), so it would be good design to document what is returned and how it will be formatted</p>
<pre><code>##&#39; Download NDVI data
##&#39; 
##&#39; @param URL  web address where data is located
##&#39; @return data.frame with 16-day windows as rows, variables as columns
download.NDVI &lt;- function(URL)</code></pre>
<p>Next we’ll fit two variants of a negative exponential model to the postfire NDVI trajectory data, and we’re going to do this twice - once using non-linear least squares (NLS), and again using Maximum Likelihood Estimation (MLE). Fortunately, there is already an efficient base R function for fitting the NLS model <code>nls()</code>, so we’ll only need to define functions for the MLE fits.</p>
<p>The input to such a fit would obviously be the same data.frame that we’re using to make the plot. We’ll also need to input a vector of initial guesses at the model parameters to help the numerical optimization converge, and we’ll want to return the full output from that numerical optimization so that we can check if it converged successfully. Finally, optimizing MLE requires a) defining the model and b) defining a function to optimize the parameters by minimizing the negative log of the likelihood. Because all that’s returned from the MLE optimization is the list if parameters of the model (and not the model itself), if we want to make a plot of models afterward, we need a separate function that can take the parameters and perform the model calculation to predict the shape of the curve. Since we need the same function to do the optimization and the plotting, it’s more efficient to define it as a separate function.</p>
<p>First we’ll do the functions for the simpler variant of the model:</p>
<pre><code>##&#39; Function (a) to define the model for the simple negative exponential model using MLE:
##&#39; @param theta  vector of model parameters in order: alpha, gamma, lambda
##&#39; @param x      vector of x values
##&#39; @return vector of model predictions
pred.negexp &lt;- function(theta, x)

##&#39; Function (b) to fit the simple negative exponential model and minimize the -ln.likelihood
##&#39; @param dat  dataframe of NDVI, age
##&#39; @param par  vector of initial parameter guesstimates (on order of theta)
##&#39; @return  output from numerical optimization
fit.negexp.MLE &lt;- function(dat,par)</code></pre>
<p>Then we’ll do the functions for the full model:</p>
<pre><code>##&#39; Function (a) to define the full model using MLE:
##&#39; @param theta  vector of model parameters in order: alpha, gamma, lambda, A, phi (NOTE THE TWO EXTRA PARAMETERS!)
##&#39; @param x      vector of x values
##&#39; @return vector of model predictions
pred.negexpS &lt;- function(theta, x)

##&#39; Function (b) to fit the full model and minimize the -ln.likelihood
##&#39; @param dat  dataframe of NDVI, age
##&#39; @param par  vector of initial parameter guesstimates (on order of theta)
##&#39; @return  output from numerical optimization
fit.negexpS.MLE &lt;- function(dat,par)</code></pre>
<p>At this point we’ve spent a good bit of time up front on organization – we have a detailed plan of attack and have thought carefully about what each module is responsible for doing. Each task has well-defined inputs, outputs, and goals. Rather than facing a thankless job of documenting our code after we’re done, even though we haven’t written a single line of code yet we are largely done with our documentation. What remains to do is implementation.</p>
</div>
<div id="task-1-create-clone-repository" class="section level2" number="6.4">
<h2><span class="header-section-number">6.4</span> Task 1: Create &amp; Clone Repository</h2>
<p>Because we’re going to employ version control in our project, our first step is to create the repository that our project will be stored in. <strong>To ensure that both you and your partner get to see every step of how to work with version control, for the rest of this exercise you are going to complete every step twice, once from the perspective of the OWNER of the repository and once as the COLLABORATOR</strong>.</p>
<div id="owner" class="section level3" number="6.4.1">
<h3><span class="header-section-number">6.4.1</span> OWNER</h3>
<ol style="list-style-type: decimal">
<li>Go to your account on <a href="https://github.com/">github.com</a> and under the Repositories tab click on the “New” button (green with a picture of a book on it)</li>
<li>Choose a name for your repository, but <strong>make sure it’s different from your partner’s</strong> (Don’t choose a “Repository template,” and keep it a “Public” repository)</li>
<li>Click the “Initialize this repository with a README” checkbox</li>
<li>Optionally also provide a Description, Add a licence (e.g. MIT), and add R to the .gitignore (check “.gitignore” and search for the <em>R</em> template)</li>
<li>Click “Create Repository”</li>
<li>Copy the URL of your new repository by clicking the clipboard icon</li>
<li>To clone the repository, open up RStudio and create a New Project using this URL. <strong>Note:</strong> If you already have a project open it will close when you do so. Don’t worry, you can return to that project after the prac using the drop-down in the top-right of the RStudio window.</li>
</ol>
<ul>
<li>Select New Project from the menu in the top right corner</li>
<li>Select Version Control then Git</li>
<li>Paste the URL in and click Create Project</li>
</ul>
</div>
</div>
<div id="task-2-add-the-first-function-download.ndvi" class="section level2" number="6.5">
<h2><span class="header-section-number">6.5</span> Task 2: Add the first function: download.NDVI</h2>
<p>Within this project we’ll create separate files for each part of the analysis. To make the order of the workflow clear we’ll want to name the files systematically. In the first file we’ll implement the download.NDVI() function.</p>
<blockquote>
<p>NOTE: You’ll see that I’ve provided the R code for how I actually accessed the data using library(“MODISTools”), but have left that commented out. The function can take quite a long time so I thought best that we just read the output of that call from a file I’ve saved to the GitHub repository.</p>
</blockquote>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="practical.html#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="do">##&#39; Download MODIS NDVI data</span></span>
<span id="cb6-2"><a href="practical.html#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="do">##&#39; @param URL  web address where data is located</span></span>
<span id="cb6-3"><a href="practical.html#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="do">##&#39;</span></span>
<span id="cb6-4"><a href="practical.html#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="do">## 1) How I really did it. For the prac we&#39;ll use option 2 because it&#39;s faster</span></span>
<span id="cb6-5"><a href="practical.html#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="do">## library(&quot;MODISTools&quot;) #Call R library MODISTools that allows us to download MODIS satellite data directly into R</span></span>
<span id="cb6-6"><a href="practical.html#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="do">##</span></span>
<span id="cb6-7"><a href="practical.html#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="do">## ndvi &lt;- mt_subset(product = &quot;MOD13Q1&quot;,</span></span>
<span id="cb6-8"><a href="practical.html#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="do">##                         lat = -34.100875,</span></span>
<span id="cb6-9"><a href="practical.html#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="do">##                         lon = 18.449375,</span></span>
<span id="cb6-10"><a href="practical.html#cb6-10" aria-hidden="true" tabindex="-1"></a><span class="do">##                         band = &quot;250m_16_days_NDVI&quot;,</span></span>
<span id="cb6-11"><a href="practical.html#cb6-11" aria-hidden="true" tabindex="-1"></a><span class="do">##                         start = &quot;2000-01-01&quot;,</span></span>
<span id="cb6-12"><a href="practical.html#cb6-12" aria-hidden="true" tabindex="-1"></a><span class="do">##                         end = &quot;2021-10-01&quot;,</span></span>
<span id="cb6-13"><a href="practical.html#cb6-13" aria-hidden="true" tabindex="-1"></a><span class="do">##                         progress = FALSE)</span></span>
<span id="cb6-14"><a href="practical.html#cb6-14" aria-hidden="true" tabindex="-1"></a><span class="do">##</span></span>
<span id="cb6-15"><a href="practical.html#cb6-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-16"><a href="practical.html#cb6-16" aria-hidden="true" tabindex="-1"></a><span class="do">## 2) How we&#39;ll do it for the prac: Read the data from a .csv file in my github repository for the course notes</span></span>
<span id="cb6-17"><a href="practical.html#cb6-17" aria-hidden="true" tabindex="-1"></a><span class="do">##</span></span>
<span id="cb6-18"><a href="practical.html#cb6-18" aria-hidden="true" tabindex="-1"></a>download.NDVI <span class="ot">&lt;-</span> <span class="cf">function</span>(URL) {</span>
<span id="cb6-19"><a href="practical.html#cb6-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-20"><a href="practical.html#cb6-20" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Wrap function in an if/else loop that checks if the URL is valid</span></span>
<span id="cb6-21"><a href="practical.html#cb6-21" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">length</span>(URL) <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> <span class="fu">is.character</span>(URL) <span class="sc">&amp;</span> <span class="fu">substr</span>(URL,<span class="dv">1</span>,<span class="dv">4</span>)<span class="sc">==</span><span class="st">&quot;http&quot;</span>) {</span>
<span id="cb6-22"><a href="practical.html#cb6-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-23"><a href="practical.html#cb6-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Read in data</span></span>
<span id="cb6-24"><a href="practical.html#cb6-24" aria-hidden="true" tabindex="-1"></a>    modat <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(URL)</span>
<span id="cb6-25"><a href="practical.html#cb6-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-26"><a href="practical.html#cb6-26" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Convert Digital Numbers (more efficient for data storage) to NDVI</span></span>
<span id="cb6-27"><a href="practical.html#cb6-27" aria-hidden="true" tabindex="-1"></a>    modat<span class="sc">$</span>NDVI <span class="ot">&lt;-</span> modat<span class="sc">$</span>value<span class="sc">*</span><span class="fl">0.0001</span></span>
<span id="cb6-28"><a href="practical.html#cb6-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-29"><a href="practical.html#cb6-29" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Convert calendar_date to class &quot;Date&quot;</span></span>
<span id="cb6-30"><a href="practical.html#cb6-30" aria-hidden="true" tabindex="-1"></a>    modat<span class="sc">$</span>calendar_date <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="fu">as.character</span>(modat<span class="sc">$</span>calendar_date))</span>
<span id="cb6-31"><a href="practical.html#cb6-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-32"><a href="practical.html#cb6-32" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Return the data</span></span>
<span id="cb6-33"><a href="practical.html#cb6-33" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(modat)</span>
<span id="cb6-34"><a href="practical.html#cb6-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-35"><a href="practical.html#cb6-35" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb6-36"><a href="practical.html#cb6-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-37"><a href="practical.html#cb6-37" aria-hidden="true" tabindex="-1"></a>    <span class="co"># If the URL is not valid return...</span></span>
<span id="cb6-38"><a href="practical.html#cb6-38" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">&quot;download.NDVI: Input URL not provided correctly&quot;</span>,URL))</span>
<span id="cb6-39"><a href="practical.html#cb6-39" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb6-40"><a href="practical.html#cb6-40" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<div id="owner-1" class="section level3" number="6.5.1">
<h3><span class="header-section-number">6.5.1</span> OWNER</h3>
<ol style="list-style-type: decimal">
<li>In RStudio, click File &gt; New File &gt; R Script</li>
<li>Copy and Paste the above function into this file</li>
<li>Select the code you have pasted in go to the menu <code>Code</code> &gt; <code>Comment/Uncomment lines</code> or alternatively use the quick keystroke <code>Ctrl</code> + <code>Shift</code> + <code>c</code> at once to remove the comments <code>#</code></li>
<li>Save the file as “01_download.NDVI.R”</li>
<li>From the Git tab, click the box next to the file you just created. This is equivalent to <em>git add</em> if you were doing this command line in bash or terminal</li>
<li>Click Commit, enter a log message, and click Commit. This is equivalent to <em>git commit</em> in command line</li>
<li>To push the change up to Github click on the green up arrow. This is equivalent to <em>git push</em></li>
</ol>
</div>
</div>
<div id="task-3-collaborator-adds-plot.ndvi" class="section level2" number="6.6">
<h2><span class="header-section-number">6.6</span> Task 3: Collaborator adds plot.NDVI</h2>
<p>With the first function complete, let’s now imagine that a <strong>COLLABORATOR</strong> has been tasked with adding the second function. To do so they must first fork and clone the repository</p>
<div id="collaborator" class="section level3" number="6.6.1">
<h3><span class="header-section-number">6.6.1</span> COLLABORATOR</h3>
<ol style="list-style-type: decimal">
<li>Go to Github and navigate to the project repository within the OWNER’s workspace.</li>
<li>Click “Fork,” which will make a copy of the repository to your own workspace.</li>
<li>Copy the URL to your own version and follow the instructions above for cloning the repository in RStudio.</li>
<li>Open a new file, enter the code below, and then save the file as “02_plot.NDVI.R”</li>
</ol>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="practical.html#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="do">##&#39; Plot NDVI data</span></span>
<span id="cb7-2"><a href="practical.html#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="do">##&#39;</span></span>
<span id="cb7-3"><a href="practical.html#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="do">##&#39; @param dat  dataframe that contains columns &quot;age&quot; and &quot;NDVI&quot;</span></span>
<span id="cb7-4"><a href="practical.html#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="do">##&#39; @param fit  a fitted model to overlay on the data if present</span></span>
<span id="cb7-5"><a href="practical.html#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="do">##&#39; @param ...  additional graphing parameters</span></span>
<span id="cb7-6"><a href="practical.html#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="do">##&#39;</span></span>
<span id="cb7-7"><a href="practical.html#cb7-7" aria-hidden="true" tabindex="-1"></a>plot.NDVI <span class="ot">&lt;-</span> <span class="cf">function</span>(dat, <span class="at">fit =</span> <span class="cn">NA</span>, ...){</span>
<span id="cb7-8"><a href="practical.html#cb7-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-9"><a href="practical.html#cb7-9" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.null</span>(dat)){ <span class="co"># Begin if/else statement</span></span>
<span id="cb7-10"><a href="practical.html#cb7-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-11"><a href="practical.html#cb7-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Base plot of the data points</span></span>
<span id="cb7-12"><a href="practical.html#cb7-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plot</span>(dat<span class="sc">$</span>age, dat<span class="sc">$</span>NDVI, <span class="at">ylab =</span> <span class="st">&quot;NDVI&quot;</span>, <span class="at">xlab =</span> <span class="st">&quot;Postfire age (Years)&quot;</span>)</span>
<span id="cb7-13"><a href="practical.html#cb7-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-14"><a href="practical.html#cb7-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.na</span>(fit[<span class="dv">1</span>])){ <span class="co">#Begin inner if statement</span></span>
<span id="cb7-15"><a href="practical.html#cb7-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-16"><a href="practical.html#cb7-16" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Overlay the fitted model on the plot</span></span>
<span id="cb7-17"><a href="practical.html#cb7-17" aria-hidden="true" tabindex="-1"></a>      <span class="fu">lines</span>(dat<span class="sc">$</span>age, <span class="fu">predict</span>(fit, <span class="fu">list</span>(<span class="at">x =</span> dat<span class="sc">$</span>age)), <span class="at">col =</span> <span class="st">&#39;skyblue&#39;</span>, <span class="at">lwd =</span> <span class="dv">3</span>)</span>
<span id="cb7-18"><a href="practical.html#cb7-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-19"><a href="practical.html#cb7-19" aria-hidden="true" tabindex="-1"></a>            } <span class="co"># End inner if statement</span></span>
<span id="cb7-20"><a href="practical.html#cb7-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-21"><a href="practical.html#cb7-21" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb7-22"><a href="practical.html#cb7-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(<span class="st">&quot;plot.NDVI: input data not provided or invalid&quot;</span>)</span>
<span id="cb7-23"><a href="practical.html#cb7-23" aria-hidden="true" tabindex="-1"></a>  } <span class="co"># End if/else statement</span></span>
<span id="cb7-24"><a href="practical.html#cb7-24" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<ol start="5" style="list-style-type: decimal">
<li>Follow the instructions above to Add, Commit, and Push the file back to your Github</li>
<li>Next you want to perform a “pull request,” which will send a request to the OWNER that they pull your new code into their mainline version. From your Github page for this project, click <strong>New Pull Request</strong>.</li>
<li>Follow the instructions, creating a title, message, and confirming that you want to create the pull request</li>
</ol>
</div>
<div id="owner-2" class="section level3" number="6.6.2">
<h3><span class="header-section-number">6.6.2</span> OWNER</h3>
<ol style="list-style-type: decimal">
<li>Once the COLLABORATOR has created the pull request, you should get an automatic email and also be able to see the pull request under the “Pull Requests” tab on the Github page for the project.</li>
<li>Read the description of the proposed changes and then click on “Files Changed” to view the changes to the project. New code should be in green, while deleted code will be in pink.</li>
<li>The purpose of a pull request is to allow the OWNER to evaluate the code being added before it is added. As you read through the code, if you hover your mouse over any line of code you can insert an inline comment in the code. The COLLABORATOR would then have the ability to respond to any comments. In larger projects, all participants can discuss the code and decide whether it should be accepted or not. Furthermore, if the COLLABORATOR does any further pushes to Github before the pull request is accepted these changes will automatically become part of the pull request. While this is a very handy feature, it can also easily backfire if the COLLABORATOR starts working on something different in the meantime. This is the reason that experienced users of version control will use BRANCHES to keep different parts separate.</li>
<li>Click on the “Conversation” page to return where you started. All participants can also leave more general comments on this page.</li>
<li>If you are happy with the code, click “Merge Pull Request.” Alternatively, to outright reject a pull request you could click “Close pull request” (but please don’t do this in the prac unless your partner has made an error)</li>
</ol>
</div>
</div>
<div id="task-4-owner-adds-functions-for-model-fitting-using-mle" class="section level2" number="6.7">
<h2><span class="header-section-number">6.7</span> Task 4: Owner adds functions for model fitting using MLE</h2>
<p>We are now past the ‘set up’ stage for both the OWNER and the COLLABORATOR, so for this task we’ll explore the normal sequence of steps that the OWNER will use for day-to-day work</p>
<div id="owner-3" class="section level3" number="6.7.1">
<h3><span class="header-section-number">6.7.1</span> OWNER</h3>
<ol style="list-style-type: decimal">
<li>Pull the latest code from Github. In RStudio this is done by clicking the light blue down arrow on the Git tab. This is equivalent to the command line <em>git pull origin master</em> where origin refers to where you did your original clone from and master refers to your main branch (if you use branches you can pull other branches)</li>
<li>Next, open up a new R file, add the code below, and save as “03_negexp.R”</li>
</ol>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="practical.html#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="do">##&#39; Functions to fit negative exponential model using MLE</span></span>
<span id="cb8-2"><a href="practical.html#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="do">##&#39; </span></span>
<span id="cb8-3"><a href="practical.html#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="do">##&#39; 1) Fit SIMPLE negative exponential model using maximum likelihood estimation</span></span>
<span id="cb8-4"><a href="practical.html#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="do">##&#39; </span></span>
<span id="cb8-5"><a href="practical.html#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="do">##&#39; Function (a) to define the model for the SIMPLE negative exponential model using MLE:</span></span>
<span id="cb8-6"><a href="practical.html#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="do">##&#39; @param theta  parameter vector in order: alpha, gamma, lambda</span></span>
<span id="cb8-7"><a href="practical.html#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="do">##&#39; @param x      vector of x values</span></span>
<span id="cb8-8"><a href="practical.html#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="do">##&#39; @return vector of model predictions</span></span>
<span id="cb8-9"><a href="practical.html#cb8-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-10"><a href="practical.html#cb8-10" aria-hidden="true" tabindex="-1"></a>pred.negexp <span class="ot">&lt;-</span> <span class="cf">function</span>(theta, x){</span>
<span id="cb8-11"><a href="practical.html#cb8-11" aria-hidden="true" tabindex="-1"></a>  NDVI <span class="ot">=</span> theta[<span class="dv">1</span>] <span class="sc">+</span> theta[<span class="dv">2</span>] <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> <span class="fu">exp</span>(<span class="sc">-</span> x<span class="sc">/</span>theta[<span class="dv">3</span>]))</span>
<span id="cb8-12"><a href="practical.html#cb8-12" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb8-13"><a href="practical.html#cb8-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-14"><a href="practical.html#cb8-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-15"><a href="practical.html#cb8-15" aria-hidden="true" tabindex="-1"></a><span class="do">##&#39; Function (b) to fit the SIMPLE negative exponential model and minimize the -ln.likelihood</span></span>
<span id="cb8-16"><a href="practical.html#cb8-16" aria-hidden="true" tabindex="-1"></a><span class="do">##&#39; @param dat  dataframe of NDVI, age</span></span>
<span id="cb8-17"><a href="practical.html#cb8-17" aria-hidden="true" tabindex="-1"></a><span class="do">##&#39; @param par  vector of initial parameter guesstimates (on order of theta)</span></span>
<span id="cb8-18"><a href="practical.html#cb8-18" aria-hidden="true" tabindex="-1"></a><span class="do">##&#39; @return  output from numerical optimization</span></span>
<span id="cb8-19"><a href="practical.html#cb8-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-20"><a href="practical.html#cb8-20" aria-hidden="true" tabindex="-1"></a>fit.negexp.MLE <span class="ot">&lt;-</span> <span class="cf">function</span>(dat,par){</span>
<span id="cb8-21"><a href="practical.html#cb8-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-22"><a href="practical.html#cb8-22" aria-hidden="true" tabindex="-1"></a>  <span class="do">## define log likelihood</span></span>
<span id="cb8-23"><a href="practical.html#cb8-23" aria-hidden="true" tabindex="-1"></a>  lnL.negexp <span class="ot">&lt;-</span> <span class="cf">function</span>(theta,dat){</span>
<span id="cb8-24"><a href="practical.html#cb8-24" aria-hidden="true" tabindex="-1"></a>    <span class="sc">-</span><span class="fu">sum</span>(<span class="fu">dnorm</span>(dat<span class="sc">$</span>NDVI, <span class="fu">pred.negexp</span>(theta, dat<span class="sc">$</span>age), <span class="fl">0.001</span>, <span class="at">log=</span><span class="cn">TRUE</span>), <span class="at">na.rm=</span><span class="cn">TRUE</span>) <span class="co">#Note that I added a standard deviation of 0.001 (in reality we should get that from the MODIS data)</span></span>
<span id="cb8-25"><a href="practical.html#cb8-25" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb8-26"><a href="practical.html#cb8-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-27"><a href="practical.html#cb8-27" aria-hidden="true" tabindex="-1"></a>  <span class="do">## fit by numerical optimization</span></span>
<span id="cb8-28"><a href="practical.html#cb8-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">optim</span>(par, <span class="at">fn =</span> lnL.negexp, <span class="at">dat=</span>dat, <span class="at">control =</span> <span class="fu">list</span>(<span class="at">maxit =</span> <span class="dv">1000</span>))</span>
<span id="cb8-29"><a href="practical.html#cb8-29" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb8-30"><a href="practical.html#cb8-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-31"><a href="practical.html#cb8-31" aria-hidden="true" tabindex="-1"></a><span class="do">##########################################</span></span>
<span id="cb8-32"><a href="practical.html#cb8-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-33"><a href="practical.html#cb8-33" aria-hidden="true" tabindex="-1"></a><span class="do">##&#39; 2) Fit negative exponential plus mystery term using maximun likelihood estimation</span></span>
<span id="cb8-34"><a href="practical.html#cb8-34" aria-hidden="true" tabindex="-1"></a><span class="do">##&#39; Function (a) to define the FULL model using MLE:</span></span>
<span id="cb8-35"><a href="practical.html#cb8-35" aria-hidden="true" tabindex="-1"></a><span class="do">##&#39; @param theta  parameter vector in order: alpha, gamma, lambda, A, phi</span></span>
<span id="cb8-36"><a href="practical.html#cb8-36" aria-hidden="true" tabindex="-1"></a><span class="do">##&#39; @param x      vector of x values</span></span>
<span id="cb8-37"><a href="practical.html#cb8-37" aria-hidden="true" tabindex="-1"></a><span class="do">##&#39; @return vector of model predictions</span></span>
<span id="cb8-38"><a href="practical.html#cb8-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-39"><a href="practical.html#cb8-39" aria-hidden="true" tabindex="-1"></a>pred.negexpS <span class="ot">&lt;-</span> <span class="cf">function</span>(theta, x){</span>
<span id="cb8-40"><a href="practical.html#cb8-40" aria-hidden="true" tabindex="-1"></a>  NDVI <span class="ot">=</span> theta[<span class="dv">1</span>] <span class="sc">+</span> theta[<span class="dv">2</span>] <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> <span class="fu">exp</span>(<span class="sc">-</span> x<span class="sc">/</span>theta[<span class="dv">3</span>])) <span class="sc">+</span></span>
<span id="cb8-41"><a href="practical.html#cb8-41" aria-hidden="true" tabindex="-1"></a>    theta[<span class="dv">4</span>] <span class="sc">*</span> <span class="fu">sin</span>(<span class="dv">2</span><span class="sc">*</span>pi<span class="sc">*</span>x <span class="sc">+</span> (theta[<span class="dv">5</span>] <span class="sc">+</span> pi<span class="sc">/</span><span class="dv">6</span><span class="sc">*</span>(<span class="dv">3</span> <span class="sc">-</span> <span class="dv">1</span>)))</span>
<span id="cb8-42"><a href="practical.html#cb8-42" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb8-43"><a href="practical.html#cb8-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-44"><a href="practical.html#cb8-44" aria-hidden="true" tabindex="-1"></a><span class="do">##&#39; Function (b) to fit the full model and minimize the -ln.likelihood</span></span>
<span id="cb8-45"><a href="practical.html#cb8-45" aria-hidden="true" tabindex="-1"></a><span class="do">##&#39;</span></span>
<span id="cb8-46"><a href="practical.html#cb8-46" aria-hidden="true" tabindex="-1"></a><span class="do">##&#39; @param dat  dataframe of NDVI, age</span></span>
<span id="cb8-47"><a href="practical.html#cb8-47" aria-hidden="true" tabindex="-1"></a><span class="do">##&#39; @param par  vector of initial parameter guesstimates (on order of theta)</span></span>
<span id="cb8-48"><a href="practical.html#cb8-48" aria-hidden="true" tabindex="-1"></a><span class="do">##&#39; @return  output from numerical optimization</span></span>
<span id="cb8-49"><a href="practical.html#cb8-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-50"><a href="practical.html#cb8-50" aria-hidden="true" tabindex="-1"></a>fit.negexpS.MLE <span class="ot">&lt;-</span> <span class="cf">function</span>(dat,par){</span>
<span id="cb8-51"><a href="practical.html#cb8-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-52"><a href="practical.html#cb8-52" aria-hidden="true" tabindex="-1"></a>  <span class="do">## define log likelihood</span></span>
<span id="cb8-53"><a href="practical.html#cb8-53" aria-hidden="true" tabindex="-1"></a>  lnL.negexpS <span class="ot">&lt;-</span> <span class="cf">function</span>(theta,dat){</span>
<span id="cb8-54"><a href="practical.html#cb8-54" aria-hidden="true" tabindex="-1"></a>    <span class="sc">-</span><span class="fu">sum</span>(<span class="fu">dnorm</span>(dat<span class="sc">$</span>NDVI, <span class="fu">pred.negexpS</span>(theta, dat<span class="sc">$</span>age), <span class="fl">0.001</span>, <span class="at">log=</span><span class="cn">TRUE</span>), <span class="at">na.rm=</span><span class="cn">TRUE</span>) <span class="co">#Note that I added a standard deviation of 0.001 (in reality we should get that from the MODIS data)</span></span>
<span id="cb8-55"><a href="practical.html#cb8-55" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb8-56"><a href="practical.html#cb8-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-57"><a href="practical.html#cb8-57" aria-hidden="true" tabindex="-1"></a>  <span class="do">## fit by numerical optimization</span></span>
<span id="cb8-58"><a href="practical.html#cb8-58" aria-hidden="true" tabindex="-1"></a>  <span class="fu">optim</span>(par, <span class="at">fn =</span> lnL.negexpS, <span class="at">dat=</span>dat, <span class="at">control =</span> <span class="fu">list</span>(<span class="at">maxit =</span> <span class="dv">1000</span>))</span>
<span id="cb8-59"><a href="practical.html#cb8-59" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li>As before, add your new file under the Git tab, Commit the change, and push it back to Github</li>
</ol>
<p><br></p>
<p>To estimate the parameters in the model we’re using the likelihood principle which states that “a parameter value is more likely than another if it is the one for which the data are more probable.” To do this we need to define a Likelihood, which is the relationship between the value of the parameter and the probability of some observed data. [For the record, the Likelihood is not a probability distribution because it does not integrate to 1]. In this case we’re assuming a Normal likelihood (hence the use of <code>dnorm()</code> in the function) and use a standard deviation (0.001) that I’ve made up to represent the uncertainty (ideally this should come from the data; e.g. the radiative transfer modelling that was used to estimate the “surface reflectance” MODIS product from the “top of atmosphere reflectance” that is actually observed by the satellite). In a more detailed analysis we’d want to follow up to check both these assumptions, but it’s a simple starting point for this practical demonstration.</p>
<p>Applying the likelihood principle we would then look for the most likely value of <span class="math inline">\(\theta\)</span>, the vector of parameters in the model (<span class="math inline">\(\alpha\)</span>, <span class="math inline">\(\gamma\)</span> and <span class="math inline">\(\lambda\)</span> in the simpler model, and adding <span class="math inline">\(A\)</span> and <span class="math inline">\(\phi\)</span> in the full model), which we call the Maximum Likelihood estimate. For a number or reasons that we won’t go into in this module, it is common to work with negative log likelihoods instead of likelihoods, in which case the negative implies that instead of looking for the maximum we’re now looking for the minimum (perhaps a bit difficult to get your head around, but it’s a small trade-off that makes for much easier mathematics). The fact that logarithm is a monotonic transformation means that taking the log does not change the location of this minimum.</p>
<p>The code for this comes in three parts.</p>
<p>First are the models themselves, <em>pred.negexp()</em> and <em>pred.negexpS()</em>, which translate the equations:</p>
<ul>
<li>For the “simple” model (<em>pred.negexp()</em>) it’s just a negative exponential:</li>
</ul>
<p><span class="math display">\[\begin{gather}
  \text{NDVI}_{i,t}=\alpha_i+\gamma_i\Big(1-e^{-\frac{age_{i,t}}{\lambda_i}}\Big)
\end{gather}\]</span></p>
<ul>
<li>For the “full” model (<em>pred.negexpS()</em>) we include a sine term:</li>
</ul>
<p><span class="math display">\[\begin{gather}
  \text{NDVI}_{i,t}=\alpha_i+\gamma_i\Big(1-e^{-\frac{age_{i,t}}{\lambda_i}}\Big)+
      A_i\text{sin}\Big(2\pi\times\text{age}_{i,t}+\Big[\phi+\frac{\pi}{6}(m_{i,t}-1)\Big]\Big)
\end{gather}\]</span></p>
<p>Where:</p>
<ul>
<li><span class="math inline">\(\alpha\)</span> is the NDVI at time 0 (i.e. directly after the fire)</li>
<li><span class="math inline">\(\gamma\)</span> is the maximum average <em>increase</em> in NDVI
<ul>
<li>i.e. the maximum NDVI reached by the blue curve is <span class="math inline">\(\alpha + \gamma\)</span></li>
</ul></li>
<li><span class="math inline">\(\lambda\)</span> is the rate of increase in NDVI</li>
<li><span class="math inline">\(A\)</span> is the amplitude of the sine term</li>
<li><span class="math inline">\(\phi\)</span> adjusts the timing of the sine term to account for the month the fire occurred</li>
</ul>
<p>Second is the negative log likelihood function, <em>lnL.negexp()</em>, which we’re trying to minimize. The core of this is the Normal probability density, <em>dnorm()</em>. The first argument is the data, the second the is model, and the third is the standard deviation. The fourth argument says that we want to return the log density, which is much more accurate if it’s performed internally than if we take the log of what’s returned by dnorm. Since we have many data points dnorm returns a vector, which we then sum up and change the sign to turn this into a minimization problem.</p>
<p>The third part is a call to a numerical optimization function, <em>optim</em>, that searches through parameter space to find the set of parameters that minimize the negative log likelihood (i.e. that Maximize the Likelihood). Arguments are the initial parameter guesstimates, the function being minimized, and any additional parameters that get passed on to that function.</p>
</div>
</div>
<div id="task-5-collaborator-adds-the-master-script" class="section level2" number="6.8">
<h2><span class="header-section-number">6.8</span> Task 5: Collaborator adds the master script</h2>
<p>The day-to-day workflow for the COLLABORATOR is similar, but not exactly the same as the OWNER. The biggest differences are that the COLLABORATOR needs to pull from the OWNER, not their own repository, and needs to do a pull request after the push.</p>
<div id="collaborator-1" class="section level3" number="6.8.1">
<h3><span class="header-section-number">6.8.1</span> COLLABORATOR</h3>
<ol style="list-style-type: decimal">
<li>Pull from OWNER. Unfortunately, this has to be done from the command line rather than the pull button within RStudio, which just pulls from the COLLABORATOR’s repository. In RStudio go to Tools &gt; Shell to open a terminal</li>
<li>At the terminal type</li>
</ol>
<pre><code>git pull URL master</code></pre>
<p>where URL is the address of the OWNER’s Github repository. Because it is a pain to always remember and type in the OWNER’s URL, it is common to define this as <em>upstream</em></p>
<pre><code>git remote add upstream URL</code></pre>
<p>which is a one-time task, after which you can do the pull as</p>
<pre><code>git pull upstream master</code></pre>
<ol start="3" style="list-style-type: decimal">
<li>Open a new Rmd file and add the text and code chunks below. This code just flushes out the pseudocode outline we started with at the beginning of this activity.</li>
</ol>
</div>
</div>
<div id="master-script-for-postfire-analysis" class="section level2" number="6.9">
<h2><span class="header-section-number">6.9</span> Master script for postfire analysis</h2>
<p>First we’ll <em>source()</em> (i.e. “run all code in”) the scripts with the functions we made. Then we’ll set the URL, read in the data with <em>download.NDVI()</em>, and plot it with <em>plot.NDVI()</em>.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="practical.html#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Load required functions</span></span>
<span id="cb12-2"><a href="practical.html#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="co"># if(file.exists(&quot;01_download.NDVI.R&quot;)) source(&quot;01_download.NDVI.R&quot;)</span></span>
<span id="cb12-3"><a href="practical.html#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="co"># if(file.exists(&quot;02_plot.NDVI.R&quot;))     source(&quot;02_plot.NDVI.R&quot;)</span></span>
<span id="cb12-4"><a href="practical.html#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="co"># if(file.exists(&quot;03_negexp.R&quot;))        source(&quot;03_negexp.R&quot;)</span></span>
<span id="cb12-5"><a href="practical.html#cb12-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-6"><a href="practical.html#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="do">## Download NDVI data</span></span>
<span id="cb12-7"><a href="practical.html#cb12-7" aria-hidden="true" tabindex="-1"></a>URL <span class="ot">=</span> <span class="st">&quot;https://raw.githubusercontent.com/jslingsby/BIO3019S_Ecoforecasting/master/data/modisdata.csv&quot;</span></span>
<span id="cb12-8"><a href="practical.html#cb12-8" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">download.NDVI</span>(URL)</span>
<span id="cb12-9"><a href="practical.html#cb12-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-10"><a href="practical.html#cb12-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert &quot;calendar_date&quot; to postfire age in days since fire - assuming the first date in the times eries is the time of the fire </span></span>
<span id="cb12-11"><a href="practical.html#cb12-11" aria-hidden="true" tabindex="-1"></a>dat<span class="sc">$</span>age <span class="ot">&lt;-</span> (<span class="fu">as.numeric</span>(dat<span class="sc">$</span>calendar_date) <span class="sc">-</span> <span class="fu">min</span>(<span class="fu">as.numeric</span>(dat<span class="sc">$</span>calendar_date), <span class="at">na.rm =</span> T))<span class="sc">/</span><span class="fl">365.25</span></span>
<span id="cb12-12"><a href="practical.html#cb12-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-13"><a href="practical.html#cb12-13" aria-hidden="true" tabindex="-1"></a><span class="do">## Plot overall NDVI time series</span></span>
<span id="cb12-14"><a href="practical.html#cb12-14" aria-hidden="true" tabindex="-1"></a><span class="fu">plot.NDVI</span>(dat)</span></code></pre></div>
<p><img src="BIO3019S-Ecoforecasting_files/figure-html/unnamed-chunk-4-1.png" width="672" /></p>
<p>Now we’ll fit the simple and full negative exponential models using Non-linear Least Squares (NLS).</p>
<p>First the simpler model:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="practical.html#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Simple model</span></span>
<span id="cb13-2"><a href="practical.html#cb13-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-3"><a href="practical.html#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="co"># set parameters</span></span>
<span id="cb13-4"><a href="practical.html#cb13-4" aria-hidden="true" tabindex="-1"></a>par <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="at">alpha =</span> <span class="fl">0.2</span>, <span class="at">gamma =</span> <span class="fl">0.4</span>, <span class="at">lambda =</span> <span class="fl">0.5</span>)</span>
<span id="cb13-5"><a href="practical.html#cb13-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-6"><a href="practical.html#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="co"># fit model</span></span>
<span id="cb13-7"><a href="practical.html#cb13-7" aria-hidden="true" tabindex="-1"></a>fit_negexp <span class="ot">&lt;-</span> <span class="fu">fit.negexp.nls</span>(<span class="at">dat =</span> dat, <span class="at">theta =</span> par)</span>
<span id="cb13-8"><a href="practical.html#cb13-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-9"><a href="practical.html#cb13-9" aria-hidden="true" tabindex="-1"></a><span class="co"># plot</span></span>
<span id="cb13-10"><a href="practical.html#cb13-10" aria-hidden="true" tabindex="-1"></a><span class="fu">plot.NDVI</span>(<span class="at">dat =</span> dat, <span class="at">fit =</span> fit_negexp)</span></code></pre></div>
<p><img src="BIO3019S-Ecoforecasting_files/figure-html/unnamed-chunk-5-1.png" width="672" /></p>
<p>And let’s look at the model summary with parameter estimates</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="practical.html#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># print model summary</span></span>
<span id="cb14-2"><a href="practical.html#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit_negexp)</span></code></pre></div>
<pre><code>## 
## Formula: NDVI ~ alpha + gamma * (1 - exp(-age/lambda))
## 
## Parameters:
##        Estimate Std. Error t value Pr(&gt;|t|)    
## alpha   0.25107    0.02887   8.695 1.04e-14 ***
## gamma   0.32371    0.02723  11.887  &lt; 2e-16 ***
## lambda  1.17687    0.21396   5.500 1.84e-07 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 0.07302 on 135 degrees of freedom
## 
## Number of iterations to convergence: 12 
## Achieved convergence tolerance: 3.924e-06</code></pre>
<p>Now the full model:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="practical.html#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Full model</span></span>
<span id="cb16-2"><a href="practical.html#cb16-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3"><a href="practical.html#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="co"># set parameters</span></span>
<span id="cb16-4"><a href="practical.html#cb16-4" aria-hidden="true" tabindex="-1"></a>par <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="at">alpha =</span> <span class="fl">0.2</span>, <span class="at">gamma =</span> <span class="fl">0.4</span>, <span class="at">lambda =</span> <span class="fl">0.5</span>, <span class="at">A =</span> <span class="fl">0.6</span>, <span class="at">phi =</span> <span class="dv">0</span>)</span>
<span id="cb16-5"><a href="practical.html#cb16-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-6"><a href="practical.html#cb16-6" aria-hidden="true" tabindex="-1"></a><span class="co"># fit model</span></span>
<span id="cb16-7"><a href="practical.html#cb16-7" aria-hidden="true" tabindex="-1"></a>fit_negexpS <span class="ot">&lt;-</span> <span class="fu">fit.negexpS.nls</span>(<span class="at">dat =</span> dat, <span class="at">theta =</span> par)</span>
<span id="cb16-8"><a href="practical.html#cb16-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-9"><a href="practical.html#cb16-9" aria-hidden="true" tabindex="-1"></a><span class="co"># plot</span></span>
<span id="cb16-10"><a href="practical.html#cb16-10" aria-hidden="true" tabindex="-1"></a><span class="fu">plot.NDVI</span>(<span class="at">dat =</span> dat, <span class="at">fit =</span> fit_negexpS)</span></code></pre></div>
<p><img src="BIO3019S-Ecoforecasting_files/figure-html/unnamed-chunk-7-1.png" width="672" /></p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="practical.html#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># print model summary</span></span>
<span id="cb17-2"><a href="practical.html#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit_negexpS)</span></code></pre></div>
<pre><code>## 
## Formula: NDVI ~ alpha + gamma * (1 - exp(-age/lambda)) + A * sin(2 * pi * 
##     age + (phi + pi/6 * (3 - 1)))
## 
## Parameters:
##         Estimate Std. Error t value Pr(&gt;|t|)    
## alpha   0.207522   0.024948   8.318 9.31e-14 ***
## gamma   0.364746   0.023926  15.245  &lt; 2e-16 ***
## lambda  0.989154   0.126064   7.846 1.25e-12 ***
## A       0.063136   0.007114   8.875 4.12e-15 ***
## phi    -0.839167   0.111887  -7.500 8.10e-12 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 0.05835 on 133 degrees of freedom
## 
## Number of iterations to convergence: 15 
## Achieved convergence tolerance: 6.939e-06</code></pre>
<p>Lots more parameters, but how do the estimates for the common parameters compare?</p>
<p>How do we know which model is better?</p>
<p>A great way to compare models is using the Akaike information criterion (AIC), which is an estimator of prediction error (i.e. relative quality) of statistical models for a given set of data. The formula for the Akaike information criterion is:</p>
<p><span class="math inline">\(AIC = 2K -2(ln(L))\)</span></p>
<p>Where:</p>
<ul>
<li><span class="math inline">\(k\)</span> = the number of estimated parameters in the model</li>
<li><span class="math inline">\(L\)</span> = maximum value of the likelihood function for the model</li>
</ul>
<p>When comparing models, the lower the AIC the better, and in general a difference in AIC of 3 or more is analagous to the models being significantly different at an <span class="math inline">\(\alpha\)</span> of <span class="math inline">\(p &lt; 0.05\)</span>.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="practical.html#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">AIC</span>(fit_negexp, fit_negexpS)</span></code></pre></div>
<pre><code>##             df       AIC
## fit_negexp   4 -325.7135
## fit_negexpS  6 -385.6718</code></pre>
<p>So it looks like the full model is much better than the simpler model…?</p>
<p>Q1: Why is it not okay to compare these models using AIC?</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="practical.html#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>((<span class="fu">AIC</span>(fit_negexpS) <span class="sc">-</span> <span class="fu">AIC</span>(fit_negexp))<span class="sc">/</span><span class="dv">2</span>)</span></code></pre></div>
<pre><code>## [1] 9.555111e-14</code></pre>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="practical.html#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(fit_negexp, fit_negexpS)</span></code></pre></div>
<pre><code>## Analysis of Variance Table
## 
## Model 1: NDVI ~ alpha + gamma * (1 - exp(-age/lambda))
## Model 2: NDVI ~ alpha + gamma * (1 - exp(-age/lambda)) + A * sin(2 * pi * age + (phi + pi/6 * (3 - 1)))
##   Res.Df Res.Sum Sq Df  Sum Sq F value   Pr(&gt;F)    
## 1    135    0.71976                                
## 2    133    0.45280  2 0.26696  39.207 4.12e-14 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>Now we’ll fit the simple and full negative exponential models using Maximum Likelihood Estimation (MLE).</p>
<p>First the simpler model:</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="practical.html#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Fit the simpler model using MLE</span></span>
<span id="cb25-2"><a href="practical.html#cb25-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-3"><a href="practical.html#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="co"># set parameters</span></span>
<span id="cb25-4"><a href="practical.html#cb25-4" aria-hidden="true" tabindex="-1"></a>par <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="at">alpha =</span> <span class="fl">0.2</span>, <span class="at">gamma =</span> <span class="fl">0.4</span>, <span class="at">lambda =</span> <span class="fl">0.5</span>)</span>
<span id="cb25-5"><a href="practical.html#cb25-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-6"><a href="practical.html#cb25-6" aria-hidden="true" tabindex="-1"></a><span class="co"># fit model</span></span>
<span id="cb25-7"><a href="practical.html#cb25-7" aria-hidden="true" tabindex="-1"></a>fit_negexpMLE <span class="ot">&lt;-</span> <span class="fu">fit.negexp.MLE</span>(dat, par)</span>
<span id="cb25-8"><a href="practical.html#cb25-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-9"><a href="practical.html#cb25-9" aria-hidden="true" tabindex="-1"></a><span class="co"># plot</span></span>
<span id="cb25-10"><a href="practical.html#cb25-10" aria-hidden="true" tabindex="-1"></a><span class="fu">plot.NDVI</span>(dat)</span>
<span id="cb25-11"><a href="practical.html#cb25-11" aria-hidden="true" tabindex="-1"></a><span class="co"># add curve with MLE parameters</span></span>
<span id="cb25-12"><a href="practical.html#cb25-12" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(dat<span class="sc">$</span>age, <span class="fu">pred.negexp</span>(fit_negexpMLE<span class="sc">$</span>par,dat<span class="sc">$</span>age), <span class="at">col =</span> <span class="st">&#39;skyblue&#39;</span>, <span class="at">lwd =</span> <span class="dv">3</span>)</span></code></pre></div>
<p><img src="BIO3019S-Ecoforecasting_files/figure-html/unnamed-chunk-12-1.png" width="672" /></p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="practical.html#cb26-1" aria-hidden="true" tabindex="-1"></a>fit_negexpMLE</span></code></pre></div>
<pre><code>## $par
##     alpha     gamma    lambda 
## 0.2510442 0.3237419 1.1767370 
## 
## $value
## [1] 359053.6
## 
## $counts
## function gradient 
##      118       NA 
## 
## $convergence
## [1] 0
## 
## $message
## NULL</code></pre>
<p>Then the full model:</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="practical.html#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Fit the full model using MLE</span></span>
<span id="cb28-2"><a href="practical.html#cb28-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-3"><a href="practical.html#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="co"># set parameters</span></span>
<span id="cb28-4"><a href="practical.html#cb28-4" aria-hidden="true" tabindex="-1"></a>par <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="at">alpha =</span> <span class="fl">0.2</span>, <span class="at">gamma =</span> <span class="fl">0.4</span>, <span class="at">lambda =</span> <span class="fl">0.5</span>, <span class="at">A =</span> <span class="fl">0.6</span>, <span class="at">phi =</span> <span class="dv">0</span>)</span>
<span id="cb28-5"><a href="practical.html#cb28-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-6"><a href="practical.html#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="co"># fit model</span></span>
<span id="cb28-7"><a href="practical.html#cb28-7" aria-hidden="true" tabindex="-1"></a>fit_negexpMLES <span class="ot">&lt;-</span> <span class="fu">fit.negexpS.MLE</span>(dat, par)</span>
<span id="cb28-8"><a href="practical.html#cb28-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-9"><a href="practical.html#cb28-9" aria-hidden="true" tabindex="-1"></a><span class="co"># plot</span></span>
<span id="cb28-10"><a href="practical.html#cb28-10" aria-hidden="true" tabindex="-1"></a><span class="fu">plot.NDVI</span>(dat)</span>
<span id="cb28-11"><a href="practical.html#cb28-11" aria-hidden="true" tabindex="-1"></a><span class="co"># add curve with MLE parameters</span></span>
<span id="cb28-12"><a href="practical.html#cb28-12" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(dat<span class="sc">$</span>age, <span class="fu">pred.negexpS</span>(fit_negexpMLES<span class="sc">$</span>par,dat<span class="sc">$</span>age), <span class="at">col =</span> <span class="st">&#39;skyblue&#39;</span>, <span class="at">lwd =</span> <span class="dv">3</span>)</span></code></pre></div>
<p><img src="BIO3019S-Ecoforecasting_files/figure-html/unnamed-chunk-14-1.png" width="672" /></p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="practical.html#cb29-1" aria-hidden="true" tabindex="-1"></a>fit_negexpMLES</span></code></pre></div>
<pre><code>## $par
##       alpha       gamma      lambda           A         phi 
##  0.20772317  0.36449293  0.98919689  0.06310554 -0.83741663 
## 
## $value
## [1] 225574.7
## 
## $counts
## function gradient 
##      914       NA 
## 
## $convergence
## [1] 0
## 
## $message
## NULL</code></pre>
<blockquote>
<p>DELETE: The Likelihood Ratio test statistic is chi-squared distributed, with degrees of freedom equal to the number of parameters that are constrained (in the current example, the number of parameters that differ between the models, i.e., 2). If you look it up on a chi-squared table, you’ll find that at 2 degrees of freedom the chi-squared statistic needs to be &gt;10.597 to be significant at an <span class="math inline">\(\alpha\)</span> of P&lt;0.05.</p>
</blockquote>
<p>When interpretting the relative difference in AIC between two models the model with the higher (worse) AIC is exp((AIC_lower - AIC_higher)/2) times as probable as the model with the lower (better) model to minimize the information loss. Let’s calculate this for our models:</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="practical.html#cb31-1" aria-hidden="true" tabindex="-1"></a>AIC_simple <span class="ot">=</span> <span class="dv">6</span> <span class="sc">+</span> <span class="dv">2</span><span class="sc">*</span>fit_negexpMLE<span class="sc">$</span>value</span>
<span id="cb31-2"><a href="practical.html#cb31-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3"><a href="practical.html#cb31-3" aria-hidden="true" tabindex="-1"></a>AIC_simple</span></code></pre></div>
<pre><code>## [1] 718113.1</code></pre>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="practical.html#cb33-1" aria-hidden="true" tabindex="-1"></a>AIC_full <span class="ot">=</span> <span class="dv">6</span> <span class="sc">+</span> <span class="dv">2</span><span class="sc">*</span>fit_negexpMLES<span class="sc">$</span>value</span>
<span id="cb33-2"><a href="practical.html#cb33-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-3"><a href="practical.html#cb33-3" aria-hidden="true" tabindex="-1"></a>AIC_full</span></code></pre></div>
<pre><code>## [1] 451155.3</code></pre>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="practical.html#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>((AIC_full <span class="sc">-</span> AIC_simple)<span class="sc">/</span><span class="dv">2</span>)</span></code></pre></div>
<pre><code>## [1] 0</code></pre>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="practical.html#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co">#LRstatistic = 2*(fit_negexpMLE$value - fit_negexpMLES$value)</span></span>
<span id="cb37-2"><a href="practical.html#cb37-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-3"><a href="practical.html#cb37-3" aria-hidden="true" tabindex="-1"></a><span class="co">#LRstatistic</span></span></code></pre></div>
<p>i.e. the probability of the worse model being as good as the better model is so low that R is happy to call it zero!!!</p>
<ol start="4" style="list-style-type: decimal">
<li>Save this file as “04_Master.Rmd.”</li>
<li>Within RStudio’s Git tab, add the file and Commit. Use the Push (up arrow) button to push this to your own repository</li>
<li>On Github.com, submit a pull request</li>
</ol>
<div id="owner-4" class="section level3" number="6.9.1">
<h3><span class="header-section-number">6.9.1</span> OWNER</h3>
<ol style="list-style-type: decimal">
<li>Evaluate and accept pull request.</li>
</ol>
<p>At this point your workflow should be complete and you should be able to run the analysis.</p>
<p><br></p>

</div>
</div>
</div>
<h3>References</h3>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-Dietze2017" class="csl-entry">
Dietze, Michael C. 2017. <em><span>Ecological Forecasting</span></em>. Princeton University Press. <a href="https://doi.org/10.2307/j.ctvc7796h">https://doi.org/10.2307/j.ctvc7796h</a>.
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="reproducibility.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="references.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/jslingsby/BIO3019S_Ecoforecasting/edit/master/04-prac.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["BIO3019S Ecoforecasting.pdf", "BIO3019S Ecoforecasting.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
